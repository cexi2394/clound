<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的个人网盘</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb', // 调整为更深的蓝色，提升质感
            secondary: '#f8fafc', // 更浅的背景色
            neutral: '#f1f5f9',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'card': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
            'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04)',
          }
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .file-card {
        @apply bg-white rounded-xl overflow-hidden border border-gray-100 transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary text-white px-4 py-2 rounded-full text-sm transition-all duration-200 hover:bg-primary/90 active:scale-95;
      }
      .btn-secondary {
        @apply bg-neutral text-gray-700 px-4 py-2 rounded-full text-sm transition-all duration-200 hover:bg-gray-200 active:scale-95;
      }
      .section-padding {
        @apply py-6 md:py-10;
      }
      .text-balance {
        text-wrap: balance;
      }
    }
  </style>
</head>

<body class="bg-secondary font-sans text-gray-800 min-h-screen">
  <!-- 顶部导航栏 -->
  <header class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-50 transition-all duration-300">
    <div class="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="bg-primary/10 p-2 rounded-lg">
          <i class="fa fa-cloud text-primary text-xl sm:text-2xl"></i>
        </div>
        <h1 class="text-lg sm:text-xl md:text-2xl font-bold bg-gradient-to-r from-primary to-blue-400 bg-clip-text text-transparent">
          我的个人网盘
        </h1>
      </div>
      <div class="flex items-center space-x-1 sm:space-x-3">
        <span class="text-sm text-gray-500 hidden sm:inline-flex items-center">
          <i class="fa fa-file-o mr-1.5"></i>
          <span id="file-count">0</span> 个文件
        </span>
        <button id="refresh-btn" class="p-2 rounded-full hover:bg-neutral transition-colors">
          <i class="fa fa-refresh text-gray-500"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="container mx-auto px-4 sm:px-6 section-padding">
    <!-- 加载状态 -->
    <div id="loading" class="text-center py-20">
      <div class="inline-block p-3 bg-primary/10 rounded-full mb-4">
        <i class="fa fa-circle-o-notch fa-spin text-primary text-3xl"></i>
      </div>
      <p class="text-gray-500 font-medium">正在加载文件列表...</p>
    </div>

    <!-- 搜索和分类容器 -->
    <div class="mb-8 opacity-0 transform translate-y-4 transition-all duration-500" id="controls-container">
      <!-- 搜索框 -->
      <div class="mb-6 max-w-2xl mx-auto">
        <div class="relative group">
          <input 
            type="text" 
            id="search-input" 
            placeholder="搜索文件名或类型..." 
            class="w-full py-3 px-4 pl-10 pr-12 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-300"
          >
          <i class="fa fa-search absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-primary transition-colors"></i>
          <button id="clear-search" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors hidden">
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>

      <!-- 分类标签 -->
      <div class="mb-2 flex items-center">
        <span class="text-sm text-gray-500 mr-3">文件分类：</span>
        <div class="flex flex-wrap gap-2">
          <button class="category-btn btn-primary" data-category="all">
            全部
          </button>
          <button class="category-btn btn-secondary" data-category="document">
            <i class="fa fa-file-text-o mr-1.5"></i>文档
          </button>
          <button class="category-btn btn-secondary" data-category="image">
            <i class="fa fa-file-image-o mr-1.5"></i>图片
          </button>
          <button class="category-btn btn-secondary" data-category="video">
            <i class="fa fa-file-video-o mr-1.5"></i>视频
          </button>
          <button class="category-btn btn-secondary" data-category="other">
            <i class="fa fa-file-o mr-1.5"></i>其他
          </button>
        </div>
      </div>
    </div>

    <!-- 文件列表 -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6" id="file-list">
      <!-- 文件卡片会通过JS动态生成 -->
    </div>

    <!-- 空状态提示 -->
    <div id="empty-state" class="hidden text-center py-20">
      <div class="inline-block p-4 bg-gray-100 rounded-full mb-5">
        <i class="fa fa-folder-open-o text-gray-300 text-5xl"></i>
      </div>
      <h3 class="text-lg font-medium text-gray-700 mb-2">未找到文件</h3>
      <p class="text-gray-500 max-w-md mx-auto text-balance">
        没有符合条件的文件，请尝试其他搜索关键词或分类
      </p>
    </div>

    <!-- 错误提示 -->
    <div id="error-state" class="hidden text-center py-20">
      <div class="inline-block p-4 bg-yellow-50 rounded-full mb-5">
        <i class="fa fa-exclamation-triangle text-yellow-500 text-3xl"></i>
      </div>
      <h3 class="text-lg font-medium text-gray-700 mb-2">加载失败</h3>
      <p class="text-gray-500 mb-4">无法获取文件列表，请尝试刷新页面</p>
      <button id="retry-btn" class="btn-primary">
        <i class="fa fa-refresh mr-1.5"></i>重新加载
      </button>
    </div>
  </main>

  <footer class="bg-white border-t border-gray-100 py-6 mt-12">
    <div class="container mx-auto px-4 sm:px-6 text-center text-gray-500 text-sm">
      <p>© 2024 个人网盘 | 基于 GitHub Pages 构建</p>
      <p class="mt-1 opacity-80">文件通过 ghproxy.net 加速访问</p>
    </div>
  </footer>

  <script>
    // 1. 配置你的仓库信息（必须修改！）
    const GITHUB_USERNAME = "cexi2394"; // 例如：octocat
    const GITHUB_REPO = "clound"; // 例如：my-cloud-storage
    const BRANCH = "main"; // 仓库分支（默认main）

    // 2. 加速链接前缀
    const PROXY_PREFIX = "https://ghproxy.net/";
    const RAW_BASE_URL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/${BRANCH}/`;

    // 3. 存储所有文件的数组（自动填充）
    let allFiles = [];

    // 4. 通过GitHub API递归获取所有文件
    async function fetchFiles(path = "") {
      try {
        const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${path}?ref=${BRANCH}`;
        const response = await fetch(apiUrl);
        
        if (!response.ok) throw new Error("获取文件失败");
        const items = await response.json();

        for (const item of items) {
          if (item.type === "file") {
            // 处理文件（排除index.html本身）
            if (item.name.toLowerCase() !== "index.html") {
              const fileUrl = item.path; // 文件相对路径
              const fileName = item.name;
              const fileType = getFileType(fileName);
              
              allFiles.push({
                name: fileName,
                url: fileUrl,
                type: fileType,
                size: formatFileSize(item.size),
                path: item.path // 用于显示文件路径
              });
            }
          } else if (item.type === "dir") {
            // 递归处理子文件夹
            await fetchFiles(item.path);
          }
        }
      } catch (error) {
        console.error("获取文件出错：", error);
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("error-state").classList.remove("hidden");
        return false;
      }
      return true;
    }

    // 5. 判断文件类型
    function getFileType(fileName) {
      const ext = fileName.split(".").pop().toLowerCase();
      const docs = ["pdf", "doc", "docx", "xls", "xlsx", "ppt", "pptx", "txt", "md", "csv"];
      const imgs = ["jpg", "jpeg", "png", "gif", "bmp", "svg", "webp", "tiff"];
      const videos = ["mp4", "avi", "mov", "mkv", "flv", "wmv", "webm", "mpg"];
      const audios = ["mp3", "wav", "flac", "aac", "ogg"];
      
      if (docs.includes(ext)) return "document";
      if (imgs.includes(ext)) return "image";
      if (videos.includes(ext)) return "video";
      if (audios.includes(ext)) return "audio"; // 新增音频分类
      return "other";
    }

    // 6. 格式化文件大小（B -> KB/MB）
    function formatFileSize(bytes) {
      if (bytes < 1024) return `${bytes} B`;
      if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
      return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
    }

    // 7. 获取文件图标和颜色
    function getFileIconInfo(type) {
      const icons = {
        document: { icon: 'fa-file-text-o', color: 'text-blue-500', bg: 'bg-blue-50' },
        image: { icon: 'fa-file-image-o', color: 'text-emerald-500', bg: 'bg-emerald-50' },
        video: { icon: 'fa-file-video-o', color: 'text-purple-500', bg: 'bg-purple-50' },
        audio: { icon: 'fa-file-audio-o', color: 'text-rose-500', bg: 'bg-rose-50' }, // 音频图标
        other: { icon: 'fa-file-o', color: 'text-gray-500', bg: 'bg-gray-50' }
      };
      return icons[type] || icons.other;
    }

    // 8. 渲染文件列表
    function renderFiles(filteredFiles = allFiles) {
      const fileListEl = document.getElementById('file-list');
      const emptyStateEl = document.getElementById('empty-state');
      const fileCountEl = document.getElementById('file-count');

      // 更新文件计数
      fileCountEl.textContent = filteredFiles.length;

      // 清空列表
      fileListEl.innerHTML = '';

      // 显示空状态或渲染文件
      if (filteredFiles.length === 0) {
        emptyStateEl.classList.remove('hidden');
        return;
      }
      emptyStateEl.classList.add('hidden');

      // 生成文件卡片（添加渐入动画）
      filteredFiles.forEach((file, index) => {
        const iconInfo = getFileIconInfo(file.type);
        const fileCard = document.createElement('div');
        fileCard.className = `file-card opacity-0 transform translate-y-4`;
        // 错开动画时间，营造层次感
        fileCard.style.transition = `opacity 0.4s ease, transform 0.4s ease`;
        fileCard.style.transitionDelay = `${index * 30}ms`;
        
        // 构建加速链接（代理+原始链接）
        const proxyUrl = `${PROXY_PREFIX}${RAW_BASE_URL}${encodeURIComponent(file.url)}`;
        
        // 提取文件路径中的文件夹部分（简化显示）
        const pathParts = file.path.split('/');
        const folderPath = pathParts.length > 1 
          ? pathParts.slice(0, -1).join('/') + '/' 
          : '根目录/';
        
        fileCard.innerHTML = `
          <div class="p-4">
            <div class="flex items-center justify-between mb-3">
              <div class="p-2 rounded-lg ${iconInfo.bg}">
                <i class="fa ${iconInfo.icon} ${iconInfo.color} text-xl"></i>
              </div>
              <span class="text-xs px-2.5 py-1 bg-neutral rounded-full font-medium">${
                file.type === 'document' ? '文档' : 
                file.type === 'image' ? '图片' : 
                file.type === 'video' ? '视频' :
                file.type === 'audio' ? '音频' : '其他'
              }</span>
            </div>
            <h3 class="font-medium text-gray-800 mb-1.5 truncate" title="${file.name}">${file.name}</h3>
            <p class="text-xs text-gray-500 mb-3 truncate" title="路径: ${folderPath}">
              <i class="fa fa-folder-o mr-1"></i>${folderPath}
            </p>
            <div class="flex items-center justify-between">
              <span class="text-xs text-gray-500">${file.size}</span>
              <a href="${proxyUrl}" target="_blank" class="inline-flex items-center text-primary text-sm hover:text-primary/80 transition-colors font-medium">
                <i class="fa fa-download mr-1.5"></i> 下载
              </a>
            </div>
          </div>
        `;
        
        fileListEl.appendChild(fileCard);
        
        // 触发动画
        setTimeout(() => {
          fileCard.classList.remove('opacity-0', 'translate-y-4');
        }, 50);
      });
    }

    // 9. 初始化页面
    async function init() {
      // 重置状态
      allFiles = [];
      document.getElementById("loading").classList.remove("hidden");
      document.getElementById("controls-container").classList.add('opacity-0', 'translate-y-4');
      document.getElementById("error-state").classList.add("hidden");
      document.getElementById("empty-state").classList.add("hidden");

      // 从GitHub API获取文件列表
      const success = await fetchFiles();
      
      if (success) {
        // 隐藏加载状态，显示内容（带动画）
        document.getElementById("loading").classList.add("hidden");
        setTimeout(() => {
          const controls = document.getElementById("controls-container");
          controls.classList.remove('opacity-0', 'translate-y-4');
        }, 100);

        // 渲染文件
        renderFiles();
      }
    }

    // 10. 事件监听
    document.addEventListener('DOMContentLoaded', () => {
      // 初始化页面
      init();

      // 刷新按钮
      document.getElementById('refresh-btn').addEventListener('click', () => {
        init();
      });

      // 重试按钮
      document.getElementById('retry-btn').addEventListener('click', () => {
        init();
      });

      // 分类筛选功能
      const categoryBtns = document.querySelectorAll('.category-btn');
      categoryBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          // 更新按钮样式
          categoryBtns.forEach(b => {
            b.classList.remove('btn-primary');
            b.classList.add('btn-secondary');
          });
          btn.classList.remove('btn-secondary');
          btn.classList.add('btn-primary');

          // 筛选文件
          const category = btn.getAttribute('data-category');
          const filteredFiles = category === 'all' 
            ? allFiles 
            : allFiles.filter(file => file.type === category);
          renderFiles(filteredFiles);
        });
      });

      // 搜索功能
      const searchInput = document.getElementById('search-input');
      const clearSearch = document.getElementById('clear-search');

      searchInput.addEventListener('input', () => {
        const keyword = searchInput.value.toLowerCase().trim();
        
        // 显示/隐藏清除按钮
        if (keyword) {
          clearSearch.classList.remove('hidden');
        } else {
          clearSearch.classList.add('hidden');
        }

        // 筛选文件
        if (!keyword) {
          renderFiles();
          return;
        }
        
        const filteredFiles = allFiles.filter(file => 
          file.name.toLowerCase().includes(keyword) || 
          file.path.toLowerCase().includes(keyword) // 支持路径搜索
        );
        renderFiles(filteredFiles);
      });

      // 清除搜索
      clearSearch.addEventListener('click', () => {
        searchInput.value = '';
        clearSearch.classList.add('hidden');
        renderFiles();
      });

      // 滚动时导航栏效果
      window.addEventListener('scroll', () => {
        const header = document.querySelector('header');
        if (window.scrollY > 10) {
          header.classList.add('shadow');
          header.classList.remove('shadow-sm');
        } else {
          header.classList.remove('shadow');
          header.classList.add('shadow-sm');
        }
      });
    });
  </script>
</body>
</html>
